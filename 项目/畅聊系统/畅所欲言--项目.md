# 项目原理

## 注册

让用户设置自己的昵称、密码等信息，注册成功后给返回一个专属用户的ID，并将这个ID保存到用户注册列表中，使用哈希map，查找的效率高

## 登陆

用户使用用户ID+密码的形式推送给服务器，然后从注册列表中查找当前用户是否存在，如果不在切换到注册界面，如果在就要校验密码是否正确，如果不正确提示重新输入，如果正确了就返回聊天窗口。

## 聊天

负责聊天的系统整体是一个大生产者消费者模型，一个线程负责接收用户的数据，发送到后端的数据池中，另一个线程负责将数据池中的数据广播给在线用户列表中的所有用户。

# 亮点

一、模拟QQ的登陆方法：让用户设置自己的昵称和密码等相关信息，但是昵称不作为标识用户身份的依据，在注册成功后，向用户返回一个唯一的登陆ID，之后用户使用ID+密码的方式登陆。这样做可以使用户避免因为昵称重复而去想自己的昵称，导致对这个产品失去兴趣。这一点虽然可以使用手机号注册，但是有很多软件都是使用手机号注册的，可能会让用户将这个软件遗忘。

# 可扩展

1、给用户返回的注册ID比较好记。

2、可以将用户的之前的聊天记录存放到云端数据库。



端口号和PID的区别



怎么实现多线程？

服务端每接收到一个请求就就给他申请一个线程，然后将这个线程分离

怎么进行多路转发？

用户列表用unordered_map保存，我们不需要有序，只需要快速查找是否在这个容器中。

在线列表中的数据是一个int（ID），另一个是struct sockaddr_in，第二个参数的原因是因为他可能会在不同的PC上登陆，所以是会随时变动的。



模仿HTTP，使用jesioncpp库实现序列化和反序列化



注册和登陆采用的是短连接的方式，一旦登陆成功或者注册成功就会断开连接，释放线程。



shell脚本：开头必须要#！然后要指明解释器的路径和名称

整个项目分为两个大模块：登陆注册模块，聊天模块+  



如果一个用户连续发送多条数据，但是其他用户并没有发送数据，这时会出现什么？



# 项目介绍

## 项目背景

我做这个项目是从今天春招的时候开始的，在春招的时候我出去找实习，面试被刷了很多，有一次我就问（完美世界）面试官，为什么我经常被刷，是因为我的专业是偏硬件的还是怎么样？面试官告诉我，找工作需要一两个合适的项目才可以，这样才能看出你的代码能力，然后我就回学校找老师聊了聊，老师让我从生活中找入口。这个畅所欲言的项目是有一次我和我爸妈开群视频的时候我给他们说了这个事，然后我爸就给举了个例子可以做一个聊天的，那之后我就开始着手准备这个项目。

## 项目原理

这个项目主要分为三个大块：客户端、服务器和数据池。

### **客户端**

主要是负责让用户操作，提供登陆、注册、退出和收发消息。

#### 登陆

用户选择登陆功能后向服务端发送请求，进入登陆模块，登陆成功后进入聊天界面，如果登录失败根据服务端返回的报文进行处理。

#### 注册

用户选择注册功能后向服务端发送注册请求，进入注册模块，提示用户输入注册信息，用户名，学校等信息，还有登陆密码，在登陆密码这里设置了一个确认密码的方法，如果两次密码输入的不一致会提示用户重新输入密码，用户设置完成后将数据发送给服务端，然后将服务端返回的用户ID输出给用户并且提示用户是否立即登录。

#### 聊天

在收发消息这块是由两个进程来完成的，使用fork函数创建一个子进程。

子进程的任务是接收用户输入的数据，通过管道的通信方式发送给父进程

父进程的任务是两个，从管道中读取数据，将数据序列化封装后发送给服务端，另一个任务是从服务端接收消息，将消息反序列化后输出给用户。

### **服务器**

主要是实现登陆、注册、退出、数据的转发。

#### 登录

在服务端维护了两个列表，一个是用于存放已经注册过的用户ID和注册信息的用户列表，另一个是用于存放已经登陆的用户ID和ID当前的端口号的在线用户列表，使用的都是unordered_map实现，

接收到来自客户端的登陆请求后，分为三步进行处理。

1、首先是将客户的登陆ID在用户列表中进行查找，如果没有找到，返回登录失败，返回原因是非法ID，并提示让用户注册，否则进行下一步。

2、去在线用户列表中查找，如果存在，说明之前已经登录，返回登录失败，返回原因是重复登录，否则进行下一步。

3、校验用户的密码，如果密码错误，返回登录失败，返回原因是密码错误，否则添加到在线用户列表，返回登陆成功（可扩展：这时会启动一个计数器，如果连续三次输错密码，就要提示用户进行找回密码。）

4、提示其他客户端当前用户已经登录。

#### 注册

接收到用户的注册请求后分为两步进行处理：

1、先生成一个唯一标识身份的用户ID返回给客户端，然后将用户信息和用户ID保存到用户列表中。

#### 数据的转发

数据转发在服务端主要是两个进程，一个进程负责将从客户端接收到的数据转发到数据池，另一个进程是负责将从数据池接收到的数据以广播的方式转发给在线用户列表中的所用客户端。

### 数据池

数据池使用的是生产找消费者模型，有两个线程和一个循环队列构成，一个线程负责从服务端接收数据存放到循环队列中，是生产者，另一个线程负责从循环队列中取数据，发送给服务端，是消费者。这个循环队列的大小为512，也就是同时可以接收512条数据，



递归和非递归的区别